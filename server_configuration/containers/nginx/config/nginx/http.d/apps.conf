server {
    listen 80;
    server_name middle.tradingenergiarz.com;
    location / {
        return 301 https://tradingenergiarz.com/middle;
    }
}

# server {
#     listen 80;
#     server_name airflow.tradingenergiarz.com;
#     location / {
#         return 301 https://tradingenergiarz.com/airflow;
#     }
# }

server {
    listen 80;
    server_name clima.tradingenergiarz.com;
    location / {
        return 301 https://tradingenergiarz.com/clima;
    }
}

server {
    listen 80;
    server_name clima2.tradingenergiarz.com;
    location / {
        return 301 https://tradingenergiarz.com;
    }
}
# Before the HTTPS server block
server {
    listen 80;
    server_name tradingenergiarz.com www.tradingenergiarz.com;

    location /new-webhook/ {
        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:6002/;
        proxy_hide_header   X-Powered-By;
    }

    # Redirect all other traffic to HTTPS
    location / {
        return 301 https://$host$request_uri;
    }
}


server {
    listen 80;
    server_name www.tradingenergiarz.com;
    return 301 https://tradingenergiarz.com$request_uri;
}


# Servidor principal


# limit_req_zone $binary_remote_addr zone=one:10m rate=500r/m;
server {
    listen 443 ssl;
    server_name www.tradingenergiarz.com tradingenergiarz.com;

    #ssl_certificate /etc/ssl/certs/ssl.crt;
    #ssl_certificate_key /etc/ssl/private/ssl.key;
    ssl_certificate /etc/letsencrypt/live/tradingenergiarz.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/tradingenergiarz.com/privkey.pem;


    location /{

        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        proxy_pass          http://172.31.13.224:8180;
        proxy_hide_header   X-Powered-By;

    }

    #ENDPOINT PARA O SITE DO MIDDLE
    #####################################################
    location /middle {
        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;

        proxy_pass          http://172.31.13.224:8090;
        proxy_hide_header   X-Powered-By;
    }

    #adicionado o /static se n√£o teriamos que mudar a estrutura de pastas 
    location /static {
        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;

        proxy_pass          http://172.31.13.224:8090;
        proxy_hide_header   X-Powered-By;
    }
    ######################################################


    #ENDPOINT PARA O SITE DO JP
    location /clima {
        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:8150;
        proxy_hide_header   X-Powered-By;
    }

    #WEBHOOK 

    location /webhook {
        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:5000;
        proxy_hide_header   X-Powered-By;
    }

    #AIRFLOW

    location /airflow {
        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:8080;
        proxy_hide_header   X-Powered-By;
    }

    #FASTAPI
    
    location /api/v2 {
        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:8000;
        proxy_hide_header   X-Powered-By;
    }


    
    location /glorian {
        
        # limit_req zone=one;

        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.55.249:80/;
        proxy_hide_header   X-Powered-By;
   }

   location /sazo {
        
        # limit_req zone=one;

        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.55.249:5000/;
        proxy_hide_header   X-Powered-By;
   }



   location /backend/ {
        
        # limit_req zone=one;

        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:6001/;
        proxy_hide_header   X-Powered-By;
   }

    location /new-webhook/ {
        
        # limit_req zone=one;

        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:6002/;
        proxy_hide_header   X-Powered-By;
   }

    location /bot-whatsapp/ {
        
        # limit_req zone=one;

        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:6000/;
        proxy_hide_header   X-Powered-By;
   }

       location /html-to-img/ {
        
        # limit_req zone=one;

        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:6003/;  
        proxy_hide_header   X-Powered-By;
   }


    location /grafana {
        
        # limit_req zone=one;

        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;
        
        proxy_pass          http://172.31.13.224:6004/grafana;  
        proxy_hide_header   X-Powered-By;
   }

    location /boletas {

        # limit_req zone=one;

        proxy_set_header    X-Real-IP  $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    Host $http_host;

        proxy_pass          http://172.31.13.224:5173;
        proxy_hide_header   X-Powered-By;
   }

}

